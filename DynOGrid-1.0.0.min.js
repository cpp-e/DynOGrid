/*! DynOGrid v1.0.0 | (c) Copyright cpp-e | github.com/cpp-e/DynOGrid/blob/main/LICENSE */
!function(e,t){"use strict";"object"==typeof module&&"object"==typeof module.exports?module.exports=e.document?t():function(e){if(!e.document)throw new Error("DynOGrid requires a window with a document");return e.DynOGrid=e.d$=t()}:e.DynTable=e.d$=t()}(window||this,function(){"use strict";let version="1.0.0";function closest(e,t){if(e.closest)return e.closest(t);let r=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector||void 0;if(void 0===r)throw new Error("DynOGrid is not supported on you browser");do{if(r.call(e,t))return e;e=e.parentElement||e.parentNode}while(null!==e&&1===e.nodeType);return null}function includes(e,t,r){return e.includes?e.includes(t,r):e.indexOf(t,r)>-1}function expandObj(e,t){let r=e&&"object"==typeof e&&Object.keys(e).length>0?expandObj({},e):{};for(let e in t)r.hasOwnProperty(e)||(r[e]=t[e]);return r}let defaultOptions={actionCell:!0,actionCellHeader:"Actions",actionCellButtons:[{text:"Delete",action:"delete"}]};function resolveVar(v){let type=v[0],vr=v.substring(1),vars=v.match(/[$@][a-zA-Z0-9_]+(\["[^$@]+"\])*/g);for(let e=0;vars&&vars.length>1&&e<vars.length;++e){let t=resolveVar(vars[e]);v=v.replace(vars[e],"array"==typeof t?t[0]:t)}return"$"===type?vars.length>1?v:eval(vr):Object.keys(eval(vr))}function updateField(e,t,r){let n=e.id,o=t.structure[n].value,i=o.match(/>[a-zA-Z0-9_]+/g);for(let e=0;i&&e<i.length;++e){let l=i[e].substring(1);t.structure.hasOwnProperty(l)&&l!=n&&(o=o.replace(">"+l,r.querySelector("#"+l).value))}let l=o.match(/[$@][a-zA-Z0-9_]+(\[".*"\])*/g);if("list"===t.structure[n].type.toLowerCase()&&l){let t=resolveVar(l[0]);if(e.innerHTML="","string"==typeof t){let r=document.createElement("option");r.innerText=t,e.appendChild(r)}else for(let r=0;r<t.length;++r){let n=document.createElement("option");n.innerText=t[r],e.appendChild(n)}}else{for(let e=0;l&&e<l.length;++e){let t=resolveVar(l[e]);o=o.replace(l[e],"array"==typeof t?t[0]:t)}e.value=o}}function updateFields(e){let t=e.target||e,r=closest(t,"tr"),n=DynOGrid(closest(r,"table")),o=n.structure[t.id].referencedIn;for(let e=0;e<o.length;++e){let t=r.querySelector("#"+o[e]);setTimeout(function(){updateField(t,n,r)})}}function DynOGrid(e,t,r){let n=e&&e.nodeType&&1===e.nodeType?e:"string"==typeof e?document.querySelector(e):void 0;if(void 0===n||"table"!==n.tagName.toLowerCase())throw new Error("Table element must be passed as first argument for DynOGrid");if(!(this instanceof DynOGrid))return n.hasOwnProperty(DynOGrid.expando)?n[DynOGrid.expando]:new DynOGrid(n,t,r);if(this.elm=n,this.structure="object"==typeof t?t:void 0,this.options=expandObj("object"==typeof r?r:{},defaultOptions),!this.structure)throw new Error("Structure object must be passed as second argument for DynOGrid to build the table");let o=document.createElement("tr");for(let e in this.structure){let t=document.createElement("th");if(t.innerText=e,o.appendChild(t),"hidden"===this.structure[e].type.toLowerCase()&&(t.style.display="none"),this.structure[e].hasOwnProperty("referencedIn")||(this.structure[e].referencedIn=[]),this.structure[e].hasOwnProperty("value")){if("list"===this.structure[e].type.toLowerCase()&&!this.structure[e].value.match(/^([$@][a-zA-Z0-9_]+(\[".*"\])*)?$/))throw new Error("The value for a list cannot be a built up string!");let t=this.structure[e].value.match(/>[a-zA-Z0-9_]+/g);for(let r=0;t&&r<t.length;++r){let n=t[r].substring(1);if(this.structure.hasOwnProperty(n)&&n!=e){if(this.structure[n].hasOwnProperty("referencedIn")||(this.structure[n].referencedIn=[]),includes(this.structure[e].referencedIn,n))throw new Error("Unsupported reference: Circular reference detected between "+e+" and "+n);includes(this.structure[n].referencedIn,e)||this.structure[n].referencedIn.push(e)}}}}if(this.options.actionCell){let e=document.createElement("th");e.innerText=this.options.actionCellHeader,o.appendChild(e)}this.elm.appendChild(o),this.elm[DynOGrid.expando]=this}return DynOGrid.expando="DynOGrid_v"+(version+Math.random()).replace(/\D/g,""),DynOGrid.version="DynOGrid "+version,DynOGrid.prototype={constructor:DynOGrid,__actions:{get __predefined(){let e=Object.keys(this);return e.splice(e.indexOf("__predefined"),1),e},delete:function(e){closest(e.target,"table").removeChild(closest(e.target,"tr"))}},add:function(){let e=this,t=document.createElement("tr");e.elm.appendChild(t);for(let r in e.structure){let n=document.createElement("td");"hidden"===e.structure[r].type.toLowerCase()&&(n.style.display="none"),t.appendChild(n);let o=document.createElement("list"===e.structure[r].type?"select":"input");o.setAttribute("id",r),"input"===o.tagName.toLowerCase()&&"readonly"===e.structure[r].type.toLowerCase()&&o.setAttribute("readonly","readonly"),o.addEventListener("change",updateFields),n.appendChild(o)}for(let r in e.structure)e.structure[r].referencedIn.length&&("list"===e.structure[r].type.toLowerCase()&&updateField(t.querySelector("#"+r),e,t),updateFields(t.querySelector("#"+r)));if(e.options.actionCell){let r=document.createElement("td");for(let t=0;t<e.options.actionCellButtons.length;++t){let n=document.createElement("button");n.innerText=e.options.actionCellButtons[t].text,n.addEventListener("click","string"==typeof e.options.actionCellButtons[t].action&&includes(e.__actions.__predefined,e.options.actionCellButtons[t].action)?e.__actions[e.options.actionCellButtons[t].action]:e.options.actionCellButtons[t].action),r.appendChild(n)}t.appendChild(r)}},get value(){let e=this.elm.querySelectorAll("tr"),t=[];for(let r=1;r<e.length;++r){let n=e[r].querySelectorAll("input,select"),o={};for(let e=0;e<n.length;++e)o[n[e].id]=n[e].value;t.push(o)}return t},get json(){return JSON.stringify(this.value)}},DynOGrid.create=function(e,t,r){return new DynOGrid(e,t,r)},DynOGrid});